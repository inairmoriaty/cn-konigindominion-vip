<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=390, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KÖNIGIN - Private</title>
  <link rel="stylesheet" href="../style/private.css">
  <link rel="stylesheet" href="../style/footer.css">
  <style>
:root{
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);

  /* 滚轮参数 */
  --item-h: 44px;         /* 单项高度（iOS感） */
  --visible: 5;           /* 可视条数（奇数，确保中间有高亮条） */
  --wheel-h: calc(var(--item-h) * var(--visible));
}

html, body {
  margin: 0; padding: 0;
  width: 100vw; height: 100vh;
  background: #191919; overflow: hidden;
}
.app-frame {
  width: 100%; height: 100vh; max-width: 1440px;
  position: relative; margin: 0 auto; border-radius: 0; overflow: hidden;
  box-shadow: none; background: #191919;
  padding-top: var(--safe-top);
  padding-bottom: calc(clamp(56px, 9vh, 72px) + var(--safe-bottom) + 20px);
  top: 0; left: 0; right: 0; bottom: 0; box-sizing: border-box;
}

.private-bg {
  position: absolute; inset: 0;
  background: url('../img/private.png') center / cover no-repeat;
  z-index: 1;
}
.private-title {
  position: absolute; top: -3%; left: 50%; transform: translateX(-50%);
  width: 750px; height: 300px;
  background: url('../svg/private/door brand.svg') center/contain no-repeat;
  z-index: 2; pointer-events: none;
}

/* —— iOS 风格滚轮 —— */
.guest-wheel {
  position: absolute;
  left: 53%;
  transform: translateX(-50%);
  top: 30%;
  width: 200px;                 /* 滚轮宽度 */
  height: var(--wheel-h);       /* 固定可视高度（5行） */
  z-index: 5;
  display: grid;
  grid-template-columns: 1fr 14px;  /* 列表 + 细滚条 */
  gap: 8px;
}
.wheel-viewport {
  position: relative;
  height: 100%;
  overflow-y: auto;
  scroll-snap-type: y mandatory;     /* 吸附 */
  scrollbar-width: none;
  -ms-overflow-style: none;
}
.wheel-viewport::-webkit-scrollbar { display: none; }

/* 渐隐遮罩（上下淡出） */
.wheel-viewport::before,
.wheel-viewport::after {
  content: "";
  position: sticky;
  display: block;
  left: 0; right: 0;
  height: calc((var(--wheel-h) - var(--item-h)) / 2);
  z-index: 2; pointer-events: none;
}
.wheel-viewport::before { top: 0; background: linear-gradient(to bottom, rgba(25,25,25,1), rgba(25,25,25,0)); }
.wheel-viewport::after  { bottom: 0; background: linear-gradient(to top, rgba(25,25,25,1), rgba(25,25,25,0)); }

/* 中间高亮选择条 */
.wheel-highlight {
  position: absolute;
  left: 0; right: 14px;  /* 让出右侧细滚条 */
  top: 50%;
  transform: translateY(calc(-50% + 1px));
  height: var(--item-h);
  border-radius: 12px;
  z-index: 3; pointer-events: none;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.12),
    inset 0 -2px 4px rgba(0,0,0,.35);
  border: 1px solid #69696955;
  background: linear-gradient(180deg, rgba(90,90,90,.15) 0%, rgba(65,65,65,.1) 100%);
}

/* 列表项 */
.wheel-list { position: relative; }
.wheel-item {
  height: var(--item-h);
  display:flex; align-items:center; justify-content:center;
  color:#fff; font-size:15px; letter-spacing:.5px;
  user-select:none; cursor:pointer;
  scroll-snap-align: center;           /* 让每项吸附到中线 */
  transition: transform .12s ease, color .12s ease;
}
.wheel-item.is-center {
  transform: scale(1.06);
  color: #fff;
  font-weight: 600;
}

/* 右侧自定义细滚条（同步视觉，不可拖拽） */
.guest-scrollbar{
  position: relative; width: 14px; height: 100%;
}
.guest-scrollbar .track{
  position: absolute; inset: 0; background: #333; border-radius: 4px; opacity:.9;
}
.guest-scrollbar .thumb{
  position: absolute; left: 0; right: 0; height: 40px; background: #666; border-radius: 4px;
  transition: top .08s linear;
}

/* 门透明热点 */
.door-hotspot{
  position: absolute; left: 50%; top: 55%;
  transform: translateX(-50%);
  width: 22%; height: 20%;
  z-index: 6; cursor: pointer; background: transparent;
}

/* 其他 */
.bottom-mask {
  position: absolute; left: 0; bottom: 0; width: 100%; height: 92px;
  background: #191919; z-index: 3; pointer-events: none;
}

.nav-circle-btn { position: absolute; z-index: 10; display: block; }
  </style>
</head>
<body>
  <div class="app-frame">
    <div class="private-bg"></div>
    <div class="private-title"></div>

    <!-- 门的透明互动区域：点击跳转到密码页 -->
    <a class="door-hotspot" id="doorHotspot" aria-label="Enter Locked Area"></a>

    <!-- iOS 风格无限滚轮 -->
    <div class="guest-wheel" id="guestWheel">
      <div class="wheel-viewport" id="wheelViewport" aria-label="Guests Picker">
        <div class="wheel-highlight"></div>
        <div class="wheel-list" id="wheelList">
          <!-- 初始内容仅用于提供数据，渲染时会重建 -->
          <div class="wheel-item" data-link="../locked_files/201.html">麦香鱼</div>
          <div class="wheel-item" data-link="../locked_files/202.html">燕麦</div>
          <div class="wheel-item" data-link="../locked_files/203.html">十七</div>
          <div class="wheel-item" data-link="../locked_files/204.html">Misty Rain</div>
          <div class="wheel-item" data-link="../locked_files/205.html">阿普</div>
          <div class="wheel-item" data-link="../locked_files/206.html">黑菓</div>
          <div class="wheel-item" data-link="../locked_files/207.html">Lloigor</div>
          <div class="wheel-item" data-link="../locked_files/208.html">氦气</div>
          <div class="wheel-item" data-link="../locked_files/209.html">咖啡</div>
          <div class="wheel-item" data-link="../locked_files/210.html">Maro</div>
          <div class="wheel-item" data-link="../locked_files/211.html">猹</div>
          <div class="wheel-item" data-link="../locked_files/212.html">清岚</div>
          <div class="wheel-item" data-link="../locked_files/213.html">Nieves</div>
          <div class="wheel-item" data-link="../locked_files/214.html">睡个好觉</div>
          <div class="wheel-item" data-link="../locked_files/215.html">明灭</div>
          <div class="wheel-item" data-link="../locked_files/216.html">冷面</div>
          <div class="wheel-item" data-link="../locked_files/217.html">夜鸦</div>
          <div class="wheel-item" data-link="../locked_files/218.html">塑料</div>
          <div class="wheel-item" data-link="../locked_files/219.html">星辰</div>
          <div class="wheel-item" data-link="../locked_files/220.html">执</div>
          <div class="wheel-item" data-link="../locked_files/221.html">赵客</div>
          <div class="wheel-item" data-link="../locked_files/222.html">猩猩狗</div>
          <div class="wheel-item" data-link="../locked_files/223.html">姬芜追</div>
          <div class="wheel-item" data-link="../locked_files/224.html">小安</div>
        </div>
      </div>
      <div class="guest-scrollbar" id="guestScrollbar">
        <div class="track"></div>
        <div class="thumb" id="guestThumb"></div>
      </div>
    </div>

    <div class="bottom-mask"></div>
  </div>

  <!-- Footer自动插入点 -->
  <div id="footer-placeholder"></div>
  <script src="../js/footer.js"></script>

  <script>
/* —— 门热点 —— */
(function(){
  const door = document.getElementById('doorHotspot');
  if (!door) return;
  door.addEventListener('click', (e) => {
    e.preventDefault();
    window.location.href = '../locked_files/master.html';
  });
})();

/* —— iOS 无限滚轮 —— */
(function(){
  const viewport = document.getElementById('wheelViewport');
  const listEl   = document.getElementById('wheelList');
  const thumb    = document.getElementById('guestThumb');
  const track    = document.getElementById('guestScrollbar');

  if (!viewport || !listEl || !thumb || !track) return;

  // 读出初始数据
  const baseItems = Array.from(listEl.querySelectorAll('.wheel-item')).map(n => ({
    text: n.textContent.trim(),
    link: n.getAttribute('data-link') || '#'
  }));
  const N = baseItems.length;

  // 重建：为了无限滚动，复制三份
  listEl.innerHTML = '';
  const COPIES = 3;
  const data = [];
  for (let c = 0; c < COPIES; c++){
    baseItems.forEach((it, idx) => {
      const d = { ...it, baseIndex: idx };
      data.push(d);
      const div = document.createElement('div');
      div.className = 'wheel-item';
      div.textContent = it.text;
      div.dataset.link = it.link;
      listEl.appendChild(div);
    });
  }

  const ITEM_H = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--item-h')) || 44;
  const VISIBLE = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--visible')) || 5;
  const WHEEL_H = ITEM_H * VISIBLE;

  // 初始位置：滚到第二份的首项（中间那份），方便两边回环
  const startIndex = N; // 第二份的开始
  viewport.scrollTop = startIndex * ITEM_H;

  // 根据 scrollTop 映射到 0..N-1 的“当前中心项”
  function getCenterIndex(){
    const top = viewport.scrollTop;
    const rawIndexTop = Math.round(top / ITEM_H);           // 对齐到最接近的项
    const centerOffset = Math.floor(VISIBLE/2);              // 中心位置偏移
    const centerRaw = rawIndexTop + centerOffset;            // 视口中心行的 raw 索引
    const baseIndex = ((centerRaw % (N*COPIES)) + (N*COPIES)) % (N*COPIES);
    return data[baseIndex].baseIndex;                        // 映射到原始索引 0..N-1
  }

   // 高亮中心项（添加/移除 is-center）
   function highlightCenter(){
     const all = listEl.querySelectorAll('.wheel-item');
     all.forEach(n => n.classList.remove('is-center'));
     
     // 计算视口中心位置对应的item
     const top = viewport.scrollTop;
     const centerRowRaw = Math.round(top / ITEM_H) + Math.floor(VISIBLE/2);
     const centerIndex = ((centerRowRaw % all.length) + all.length) % all.length;
     const centerItem = all[centerIndex];
     
     if (centerItem) {
       centerItem.classList.add('is-center');
     }
   }

  // 无限回环逻辑：滚到边缘时把 scrollTop 拉回中间那份
  function loopGuard(){
    const total = N * COPIES;
    const min = ITEM_H * (N * 0.5);                      // 稍微留些缓冲
    const max = ITEM_H * (total - N * 0.5);
    if (viewport.scrollTop < min){
      viewport.scrollTop += ITEM_H * N;                  // 向下平移一份
    }else if (viewport.scrollTop > max){
      viewport.scrollTop -= ITEM_H * N;                  // 向上平移一份
    }
  }

  // 吸附到最近项
  let snapTimer = null;
  function snapToNearest(){
    if (snapTimer) clearTimeout(snapTimer);
    snapTimer = setTimeout(() => {
      const idx = Math.round(viewport.scrollTop / ITEM_H);
      viewport.scrollTo({ top: idx * ITEM_H, behavior: 'smooth' });
    }, 80);
  }

  // 同步右侧小滚条（只是视觉提示）
  function syncThumb(){
    const totalH = ITEM_H * (N * COPIES);
    const trackH = track.clientHeight;
    const viewH  = viewport.clientHeight;
    const thumbH = Math.max(24, Math.round(viewH * viewH / Math.max(totalH, 1)));
    const maxTop = Math.max(trackH - thumbH, 0);
    const top = (viewport.scrollTop / Math.max(totalH - viewH, 1)) * maxTop;
    thumb.style.height = thumbH + 'px';
    thumb.style.top    = top + 'px';
  }

   // 点击某一项：直接跳转到对应页面
   listEl.addEventListener('click', (e) => {
     const item = e.target.closest('.wheel-item');
     if (!item) return;
     
     // 获取当前中心项的索引
     const centerIndex = getCenterIndex();
     const all = Array.from(listEl.children);
     const itemIndex = all.indexOf(item);
     
     // 计算当前点击项相对于中心的位置
     const centerRowRaw = Math.round(viewport.scrollTop / ITEM_H) + Math.floor(VISIBLE/2);
     const currentCenterItem = all[((centerRowRaw % all.length) + all.length) % all.length];
     const currentCenterIndex = all.indexOf(currentCenterItem);
     
     // 如果点击的不是中心项，先滚动到中心
     if (itemIndex !== currentCenterIndex) {
       const delta = itemIndex - currentCenterIndex;
       const targetTop = viewport.scrollTop + delta * ITEM_H;
       viewport.scrollTo({ top: targetTop, behavior: 'smooth' });
       
       // 滚动完成后跳转
       setTimeout(() => {
         const link = item.dataset.link || '#';
         if (link && link !== '#') {
           window.location.href = link;
         }
       }, 300);
     } else {
       // 如果已经是中心项，直接跳转
       const link = item.dataset.link || '#';
       if (link && link !== '#') {
         window.location.href = link;
       }
     }
   });

  // 滚动事件
  viewport.addEventListener('scroll', () => {
    loopGuard();
    highlightCenter();
    syncThumb();
    snapToNearest();
  }, { passive: true });

  // 初始同步
  requestAnimationFrame(() => {
    highlightCenter();
    syncThumb();
  });
})();
  </script>
</body>
</html>
