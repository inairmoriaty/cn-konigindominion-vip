<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KÖNIGIN - Inair</title>

  <link rel="stylesheet" href="../../style/footer.css">
  <link rel="stylesheet" href="../../style/mobile.css">
  <style>
    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    html, body {
      margin: 0; 
      padding: 0;
      width: 100%;
      height: 100vh;        /* 基础兜底 */
      height: 100svh;       /* iOS 15+ 小视口 */
      height: 100dvh;       /* 动态视口，iOS 16+ / 现代浏览器 */
      background: #191919;
      overflow: hidden;
    }

    .app-frame {
      width: 100%;
      height: 100vh;
      height: 100svh;
      height: 100dvh;
      /* 其余不变 */
    }
    
    /* 如果浏览器不支持 dvh/svh，就用 --vh 方案 */
    @supports not (height: 100dvh) {
      html, body, .app-frame { height: calc(var(--vh) * 100); }
    }
    /* 横向滑动背景容器 */
    .horizontal-bg-container {
      position: absolute;
      left: 0; 
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }

    /* 背景图片容器 - 可以左右滑动 */
    .bg-slider {
      position: absolute;
      left: 0; 
      top: 0;
      width: 300%; /* 3倍宽度，对应图片的3个部分 */
      height: 100%;
      background-image: url('../../img/master/master_bg.png');
      background-size: auto 100%; /* 保持图片比例，高度100% */
      background-position: left center;
      background-repeat: no-repeat;
      transition: transform 0.3s ease-out;
      cursor: grab;
      will-change: transform; /* 优化性能 */
    }

    .bg-slider:active {
      cursor: grabbing;
    }

    /* 滑动指示器 - 长条bar样式 */
    .slide-indicators {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 4px;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 2px;
      z-index: 10;
      cursor: pointer;
      overflow: hidden;
    }

    .indicator {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.6);
      border-radius: 2px;
      transform: scaleX(0);
      transform-origin: left center;
      transition: transform 0.3s ease;
      pointer-events: none;
    }

    .indicator.active {
      transform: scaleX(1);
    }

    /* 滑动提示 */
    .slide-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      font-family: "SimSun", "宋体", serif;
      text-align: center;
      z-index: 5;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .slide-hint.show {
      opacity: 1;
    }

    /* 内容层 */
    .content-layer {
      position: absolute;
      left: 0; 
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }

    .content-layer > * {
      pointer-events: auto;
    }

    /* 标题 */
    .page-title {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 80vw;
      height: 15vh;
      max-width: 300px;
      max-height: 120px;
      z-index: 2;
      pointer-events: none;
    }

  /* 门牌：显著增大尺寸，让门牌更显眼 */
  .inair-title{
    position: absolute;
    left: 50%;
    transform: translateX(-50%);

    /* 下移：避开刘海/地址栏 */
    top: calc(var(--safe-top, 0px) + 2vh);

    /* 尺寸：显著增大，让门牌更显眼 */
    width: clamp(400px, 85vw, 900px);
    height: clamp(120px, 25vh, 250px);
    /* 移除 aspect-ratio 限制，让门牌可以更大 */

  background: url('../../img/master/inair.png') center/cover no-repeat;
  z-index: 6;
  pointer-events: none;
  opacity: 0;
  transition: opacity .3s ease, transform .2s ease;
  filter: drop-shadow(0 2px 6px rgba(0,0,0,.5));
}

  /* 超小屏（≤390，典型 iPhone 12/13 mini 或窄窗口）显著放大 */
  @media (max-width: 390px){
    .inair-title{
      top: calc(var(--safe-top, 0px) + 10vh);
      width: clamp(350px, 90vw, 500px);
      height: clamp(100px, 20vh, 150px);
    }
  }

  /* 平板 & 桌面：保持较大尺寸 */
  @media (min-width: 768px){
    .inair-title{
      top: calc(var(--safe-top, 0px) + 6vh);
      width: clamp(500px, 50vw, 1000px);
      height: clamp(150px, 30vh, 300px);
    }
  }

/* 显示时的显隐控制（保持不变） */
.inair-title.show { opacity: 1; }

    /* 交互按钮 */
    .interaction-btn {
      position: absolute;
      z-index: 10;
      display: block;
      cursor: pointer;
    }

    .btn-bed {
      top: 75%; /* 枕头的位置，大约65%从顶部 */
      left: 50%; /* 枕头的位置，稍微偏左 */
      transform: translate(-50%, -50%);
    }

    .btn-desk {
      top: 75%; /* 桌子的位置，大约60%从顶部 */
      left: 25%; /* 桌子的位置，在左侧 */
      transform: translate(-50%, -50%);
    }

    .interaction-btn img {
      width: 8vw;
      height: 8vw;
      min-width: 60px;
      min-height: 60px;
      max-width: 100px;
      max-height: 100px;
      display: block;
      pointer-events: auto;
      transition: all 0.2s ease;
    }

    .interaction-btn:hover img {
      filter: brightness(1.2);
      transform: scale(1.05);
    }

    .interaction-btn:active img {
      filter: brightness(0.8);
      transform: scale(0.95);
    }

    /* 按钮显示/隐藏控制 */
    .interaction-btn {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
      pointer-events: none;
    }

    .interaction-btn.show {
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }

    /* 底部遮罩 */
    .bottom-mask {
      position: absolute;
      left: 0; 
      bottom: 0;
      width: 100%;
      height: 92px;
      background: #191919;
      z-index: 3;
      pointer-events: none;
    }

    /* 边界提示效果 */
    .boundary-hint {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      z-index: 15;
    }

    .boundary-hint.show {
      opacity: 1;
    }

    .boundary-hint.left {
      left: 20px;
    }

    .boundary-hint.right {
      right: 20px;
    }

    .boundary-hint::before {
      content: '';
      width: 12px;
      height: 12px;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-right: none;
    }

    .boundary-hint.left::before {
      transform: rotate(45deg);
    }

    .boundary-hint.right::before {
      transform: rotate(-135deg);
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
      .slide-indicators {
        bottom: 100px;
        width: 150px;
        height: 3px;
      }
      
      .boundary-hint {
        width: 30px;
        height: 30px;
      }
      
      .boundary-hint::before {
        width: 8px;
        height: 8px;
      }
      
      /* 移动端背景图优化 */
      .bg-slider {
        width: 300%; /* 移动端保持与桌面端一致的宽度 */
        background-size: auto 100%;
        background-position: left center;
        background-attachment: scroll;
      }
      
      /* 移动端标题优化 */
      .page-title {
        width: 90vw;
        height: 12vh;
      }
      

      
      /* 移动端客单列表优化 */
      .guest-list-wrapper {
        width: 60vw;
        height: 35vh;
      }
      
      .guest-item {
        height: 5vh;
        font-size: 3.5vw;
      }
    }

        /* 客单滚轮选项区域 */
        .guest-list-wrapper{
      position: absolute;
      left: 53%;
      transform: translateX(-50%);
      width: 45vw;
      max-width: 180px;
      top: 25%;
      height: 30vh;
      max-height: 240px;
      z-index: 20;
      display: flex;
      align-items: stretch;
      gap: 12px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .guest-list-wrapper.show {
      opacity: 1;
      visibility: visible;
    }
    
    .guest-list{
      position: relative;
      flex: 1 1 auto;
      height: 100%;
      overflow: hidden;
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 36px), rgba(0,0,0,0) 100%);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 36px), rgba(0,0,0,0) 100%);
    }
    
    .guest-list-viewport{
      height: 100%;
      overflow-y: auto;
      padding-right: 8px;
      scrollbar-width: none;
    }
    
    .guest-list-viewport::-webkit-scrollbar{ display: none; }
    
    .guest-item{
      height: 4.5vh;
      min-height: 36px;
      margin: 2vh 0;
      width: 80%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 4vw;
      font-size: clamp(12px, 4vw, 16px);
      font-family: "SimSun", "宋体", serif; /* 改为宋体 */
      letter-spacing: .5px;
      user-select: none;
      pointer-events: auto; /* 改为可点击 */
      cursor: pointer; /* 添加鼠标指针 */
      background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 45%, #414141 100%);
      border: 1px solid #696969;
      border-radius: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.12), inset 0 -2px 4px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
      transition: all 0.2s ease; /* 添加过渡效果 */
    }
    
    .guest-item:hover {
      background: linear-gradient(180deg, #6a6a6a 0%, #5a5a5a 45%, #515151 100%);
      transform: scale(1.02);
    }
    
    .guest-item:active {
      transform: scale(0.98);
    }
    

    .interaction-btn:active img {
  /* 可选：按下变暗或缩放 */
  filter: brightness(0.8);
  transform: scale(0.92);
}
@keyframes btn-blink {
  0%   { opacity: 1; filter: drop-shadow(0 0 0px #fff6) brightness(1); }
  40%  { opacity: 0.6; filter: drop-shadow(0 0 8px #e6f3ff) brightness(1.3);}
  60%  { opacity: 1; filter: drop-shadow(0 0 16px #b5e2ff) brightness(1.5);}
  100% { opacity: 1; filter: drop-shadow(0 0 0px #fff6) brightness(1); }
}
.interaction-btn.blink img {
  animation: btn-blink 1.2s infinite;
  /* 可选：动画节奏平滑 */
  animation-timing-function: ease-in-out;
}
  </style>
</head>
<body>
  <div class="app-frame">
    <div class="bg-slider"></div>
    <div class="inair-title"></div>
    
      <!-- 床上的交互按钮 -->
      <a href="#" class="interaction-btn btn-bed blink" title="Bed Interaction" id="bedButton">
        <img src="../../img/default btn.png" alt="Bed Button"/>
      </a>
      
      <!-- 桌子上的交互按钮 -->
      <a href="#" class="interaction-btn btn-desk blink" title="Desk Interaction" id="deskButton">
        <img src="../../img/default btn.png" alt="Desk Button"/>
      </a>
    
    <!-- 客单滚轮选项（默认隐藏） -->
    <div class="guest-list-wrapper" id="guestList">
      <div class="guest-list">
        <div class="guest-list-viewport" id="guestViewport">
          <div class="guest-item" data-article="domestication.html">驯化</div>
          <div class="guest-item" data-article="monroe.html">梦露小姐</div>
          <div class="guest-item" data-article="abyss.html">深渊漫步</div>
        </div>
      </div>
      </div>
    </div>
    
    <div class="bottom-mask"></div>
  </div>

    <!-- Footer自动插入点 -->
  <div id="footer-placeholder"></div>
    <script src="../../js/mobile-optimization.js"></script>
  <script src="../../js/footer.js"></script>
  <script>
    // 页面初始化
    document.addEventListener('DOMContentLoaded', function () {
      console.log('Inair page loaded');
    
      // —— 基本元素 —— 
      const bedBtn    = document.getElementById('bedButton');
      const deskBtn   = document.getElementById('deskButton');
      const guestList = document.getElementById('guestList');
    
      // 背景图片连通性测试（路径统一为无空格版本）
      const testImage = new Image();
      testImage.onload  = () => console.log('✅ 背景图可用', testImage.width, 'x', testImage.height);
      testImage.onerror = () => console.error('❌ 背景图加载失败: ../../img/master/master_bg.png');
      testImage.src     = '../../img/master/master_bg.png';
    
      // —— 客单弹出 —— 
      let isGuestListVisible = false;
      if (bedBtn) {
        const toggleGuest = (e) => {
          e.preventDefault();
          e.stopPropagation();
          isGuestListVisible = !isGuestListVisible;
          guestList.classList.toggle('show', isGuestListVisible);
        };
        bedBtn.addEventListener('click', toggleGuest);
        bedBtn.addEventListener('touchend', toggleGuest);
      }
    
      // 点击空白收起
      const dismissGuest = (e) => {
        if (!isGuestListVisible) return;
        const clickOnBed   = bedBtn && bedBtn.contains(e.target);
        const clickOnPanel = guestList && guestList.contains(e.target);
        if (!clickOnBed && !clickOnPanel) {
          isGuestListVisible = false;
          guestList.classList.remove('show');
        }
      };
      document.addEventListener('click', dismissGuest);
      document.addEventListener('touchend', dismissGuest);
    
      // —— 桌子按钮跳转 —— 
      function saveArticleHierarchySession() {
        const session = { timestamp: Date.now(), expiry: Date.now() + 30 * 60 * 1000 };
        sessionStorage.setItem('article_hierarchy_session', JSON.stringify(session));
      }
      if (deskBtn) {
        const toDesk = (e) => {
          e.preventDefault();
          e.stopPropagation();
          saveArticleHierarchySession();
          window.location.href = '../../article/private/berlin.html';
        };
        deskBtn.addEventListener('click', toDesk);
        deskBtn.addEventListener('touchend', toDesk);
      }
    
      // —— 滚轮列表点击 —— 
      const guestItems = document.querySelectorAll('.guest-item');
      guestItems.forEach((item) => {
        const go = () => {
          const f = item.getAttribute('data-article');
          if (!f) return;
          saveArticleHierarchySession();
          if (f === 'domestication.html') window.location.href = '../../article/private/domestication/catalog.html';
          else window.location.href = `../../article/private/${f}`;
        };
        item.addEventListener('click', go);
        item.addEventListener('touchend', go);
      });
    
      // =========================
      // 背景滑动（百分比方案）
      // =========================
      const bgSlider = document.querySelector('.bg-slider');
      if (!bgSlider) return;
    
      // 首屏 UI：进度条与提示
      function ensureIndicators() {
        if (document.querySelector('.slide-indicators')) return;
        const bar = document.createElement('div');
        bar.className = 'slide-indicators';
        const fill = document.createElement('div');
        fill.className = 'indicator';
        bar.appendChild(fill);
        bar.addEventListener('click', (e) => {
          const r = bar.getBoundingClientRect();
          const p = (e.clientX - r.left) / r.width;
          goToPercent(p * 100);
        });
        bar.addEventListener('touchend', (e) => {
          const r = bar.getBoundingClientRect();
          const t = e.changedTouches[0];
          const p = (t.clientX - r.left) / r.width;
          goToPercent(p * 100);
        });
        document.querySelector('.app-frame').appendChild(bar);
      }
      function ensureHint() {
        if (document.querySelector('.slide-hint')) return;
        const hint = document.createElement('div');
        hint.className = 'slide-hint';
        hint.textContent = '左右滑动查看全景';
        document.querySelector('.app-frame').appendChild(hint);
        requestAnimationFrame(() => {
          hint.classList.add('show');
          setTimeout(() => hint.classList.remove('show'), 3000);
        });
      }
      ensureIndicators();
      ensureHint();
    
      let currentPercent    = 0;    // 0 到 -maxSlidePercent
      let startPercent      = 0;
      let maxSlidePercent   = 100;  // 根据图片与视口动态计算
      let dragging          = false;
      let startX            = 0;
    
      // 计算可滑距离（百分比）
      function computeMaxSlide() {
        const img = new Image();
        img.onload = () => {
          const vw = window.innerWidth;
          const vh = window.innerHeight;
          const scale = vh / img.height;           // 背景以高度铺满
          const displayWidth = img.width * scale;  // 实际显示宽度
          if (displayWidth > vw) {
            const overflow = displayWidth - vw;
            maxSlidePercent = (overflow / vw) * 100 * 0.29; // 你的缩放系数
          } else {
            maxSlidePercent = 0;
          }
          // 初始位置往中间偏一点，确保能看到按钮区域
          currentPercent = -Math.min(maxSlidePercent, maxSlidePercent * 0.45);
          applyTransform();
          updateUIByProgress();
        };
        img.onerror = () => {
          console.warn('背景图加载失败，使用兜底 200%');
          maxSlidePercent = 200;
          currentPercent  = -maxSlidePercent * 0.2;
          applyTransform();
          updateUIByProgress();
        };
        img.src = '../../img/master/master_bg.png';
      }
    
      function clampPercent(p) {
        return Math.max(-maxSlidePercent, Math.min(0, p));
      }
      function applyTransform() {
        bgSlider.style.transform = `translateX(${clampPercent(currentPercent)}%)`;
      }
      function progress01() {
        if (maxSlidePercent <= 0) return 0;
        return Math.min(1, Math.max(0, Math.abs(currentPercent) / maxSlidePercent));
      }
      function updateIndicators() {
        const ind = document.querySelector('.indicator');
        if (!ind) return;
        ind.style.transform = `scaleX(${progress01()})`;
      }
      function updateButtons() {
        const p = progress01();
        // 按需微调区间
        const bedShow  = p >= 0.30 && p <= 0.50;
        const deskShow = p >= 0.00 && p <= 0.15;
        if (bedBtn)  bedBtn.classList.toggle('show',  bedShow);
        if (deskBtn) deskBtn.classList.toggle('show', deskShow);
      }
      function updateTitle() {
        const t = document.querySelector('.inair-title');
        if (!t) return;
        const show = progress01() >= 0.10 && progress01() <= 0.70;
        t.classList.toggle('show', show);
      }
      function updateUIByProgress() {
        updateIndicators();
        updateButtons();
        updateTitle();
      }
    
      function goToPercent(percent) {
        currentPercent = - (percent / 100) * maxSlidePercent;
        applyTransform();
        updateUIByProgress();
      }
    
      // 拖动（鼠标）
      bgSlider.addEventListener('mousedown', (e) => {
        if (isGuestListVisible) return;
        dragging   = true;
        startX     = e.clientX;
        startPercent = currentPercent;
        bgSlider.style.transition = 'none';
        bgSlider.style.cursor     = 'grabbing';
      });
      document.addEventListener('mousemove', (e) => {
        if (!dragging || isGuestListVisible) return;
        const diff = e.clientX - startX;
        let target = startPercent - (diff / window.innerWidth) * maxSlidePercent;
        if (target > 0) target *= 0.3;
        if (target < -maxSlidePercent) target = -maxSlidePercent - (Math.abs(target + maxSlidePercent) * 0.3);
        currentPercent = target;
        applyTransform();
        updateUIByProgress();
      });
      document.addEventListener('mouseup', () => {
        if (!dragging || isGuestListVisible) return;
        dragging = false;
        bgSlider.style.transition = 'transform .3s ease-out';
        currentPercent = clampPercent(currentPercent);
        applyTransform();
        updateUIByProgress();
        bgSlider.style.cursor = 'grab';
      });
    
      // 拖动（触摸）
      bgSlider.addEventListener('touchstart', (e) => {
        if (isGuestListVisible) return;
        e.preventDefault();
        dragging   = true;
        startX     = e.touches[0].clientX;
        startPercent = currentPercent;
        bgSlider.style.transition = 'none';
      }, { passive: false });
      document.addEventListener('touchmove', (e) => {
        if (!dragging || isGuestListVisible) return;
        e.preventDefault();
        const diff = e.touches[0].clientX - startX;
        let target = startPercent - (diff / window.innerWidth) * maxSlidePercent;
        if (target > 0) target *= 0.3;
        if (target < -maxSlidePercent) target = -maxSlidePercent - (Math.abs(target + maxSlidePercent) * 0.3);
        currentPercent = target;
        applyTransform();
        updateUIByProgress();
      }, { passive: false });
      document.addEventListener('touchend', () => {
        if (!dragging || isGuestListVisible) return;
        dragging = false;
        bgSlider.style.transition = 'transform .3s ease-out';
        currentPercent = clampPercent(currentPercent);
        applyTransform();
        updateUIByProgress();
      });
    
      // 首次计算、旋转重算
      computeMaxSlide();
      window.addEventListener('resize', computeMaxSlide);
    
      // 视口高度变量（老机型兜底）
      function setVH(){
        const vh = window.innerHeight * 0.01;
        document.documentElement.style.setProperty('--vh', `${vh}px`);
      }
      setVH();
      window.addEventListener('resize', setVH);
    });
    </script>
    </body>
</html>
